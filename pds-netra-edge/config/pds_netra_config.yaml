godown_id: GDN_001
timezone: Asia/Kolkata

# MQTT connection details.
mqtt:
  host: 127.0.0.1
  port: 1883
  username: null
  password: null

# ANPR Configuration Section
anpr:
  enabled: true
  model_path: "./ML_Model/anpr.pt"
  device: "cpu"
  conf: 0.0
  iou: 0.45
  imgsz: 960
  max_det: 300
  classes: [0]
  plate_class_names: null
  ocr_lang: ["en"]
  ocr_every_n: 2
  ocr_min_conf: 0.2
  ocr_debug: true
  validate_india: true
  show_invalid: false
  registered_file: null
  dedup_interval_sec: 60
  save_csv: "./anpr_debug.csv"
  # save_crops_dir: "./././anpr_crops"
  # save_crops_max: 15

tracking:
  tracker_name: "bytetrack.yaml"
  track_persist: true
  conf: 0.25
  iou: 0.5

cameras:
  - id: CAM_GATE_1
    rtsp_url: "rtsp://krishva:krishva1234@192.168.1.85:554/stream1"
    #test_video: "./data/truck_road.mp4"
    # Zones required for ANPR
    zones:
      - id: gate_outer
        polygon:
          - [0, 0]
          - [1920, 0]
          - [1920, 1080]
          - [0, 1080]
      - id: gate_inner
        polygon:
          - [0, 0]
          - [640, 0]
          - [640, 384]
          - [0, 384]
    health:
      enabled: true
      no_frame_timeout_seconds: 15
      min_fps: 3.0
      low_light_threshold: 25
      black_frame_threshold: 10
      low_light_consecutive_frames: 30
      uniform_std_threshold: 8
      blur_threshold: 50.0
      blackout_drop_ratio: 0.55
      blackout_min_baseline: 25.0
      moved_diff_threshold: 0.35
      moved_consecutive_frames: 10
      cooldown_seconds: 60
      snapshot_on_tamper: true
      blocked_consecutive_frames: 3

  - id: CAM_AISLE_3
    rtsp_url: "rtsp://krishva:krishva1234@192.168.1.85:554/stream1"
    # test_video: "./data/truck_road.mp4"
    zones:
      - id: aisle_zone3
        polygon:
          - [50, 50]
          - [500, 50]
          - [500, 350]
          - [50, 350]
    health:
      enabled: true
      no_frame_timeout_seconds: 15
      min_fps: 3.0
      low_light_threshold: 25
      black_frame_threshold: 5.0
      low_light_consecutive_frames: 10
      uniform_std_threshold: 6.0
      blur_threshold: 50.0
      blackout_drop_ratio: 0.55
      blackout_min_baseline: 25.0
      moved_diff_threshold: 0.35
      moved_consecutive_frames: 10
      cooldown_seconds: 60
      snapshot_on_tamper: false

rules:
  # ANPR Rule
  - id: RULE_ANPR_GATE_MONITOR
    type: ANPR_MONITOR
    camera_id: CAM_GATE_1
    zone_id: gate_outer

  - id: RULE_NO_PERSON_ALWAYS_GATE
    type: NO_PERSON_DURING
    camera_id: CAM_GATE_1
    zone_id: all
    start: "00:00"
    end: "23:59"
  - id: RULE_ANIMAL_INTRUSION_GATE
    type: ANIMAL_FORBIDDEN
    camera_id: CAM_GATE_1
    zone_id: zone_1
  - id: RULE_LOITERING_GATE
    type: LOITERING
    camera_id: CAM_GATE_1
    zone_id: all
    threshold_seconds: 120
  - id: RULE_BAG_MONITOR_AISLE
    type: BAG_MONITOR
    camera_id: CAM_AISLE_3
    zone_id: aisle_zone3
    cooldown_seconds: 60
  - id: RULE_BAG_ODD_HOURS_AISLE
    type: BAG_ODD_HOURS
    camera_id: CAM_AISLE_3
    zone_id: aisle_zone3
    start_local: "20:00"
    end_local: "06:00"
    cooldown_seconds: 60
  - id: RULE_BAG_UNPLANNED_AISLE
    type: BAG_UNPLANNED
    camera_id: CAM_AISLE_3
    zone_id: aisle_zone3
    require_active_dispatch_plan: true
    cooldown_seconds: 60
  - id: RULE_BAG_TALLY_MISMATCH_AISLE
    type: BAG_TALLY_MISMATCH
    camera_id: CAM_AISLE_3
    zone_id: aisle_zone3
    allowed_overage_percent: 10
    cooldown_seconds: 120
  - id: RULE_NO_PERSON_ALWAYS_AISLE
    type: NO_PERSON_DURING
    camera_id: CAM_AISLE_3
    zone_id: all
    start: "00:00"
    end: "23:59"
  - id: RULE_LOITERING_AISLE
    type: LOITERING
    camera_id: CAM_AISLE_3
    zone_id: all
    threshold_seconds: 120

# Face recognition configuration
face_recognition:
  enabled: true
  known_faces_file: "config/known_faces.json"
  min_match_confidence: 0.6
  unknown_event_enabled: true
  dedup_interval_seconds: 60
  cameras:
    - camera_id: CAM_GATE_1
      zone_id: all
      allow_unknown: false
      log_known_only: false
    - camera_id: CAM_AISLE_3
      zone_id: all
      allow_unknown: false
      log_known_only: false
