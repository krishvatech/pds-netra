version: "3.8"

services:
  mosquitto:
    image: eclipse-mosquitto:2
    restart: unless-stopped
    ports:
      - "1883:1883"
    volumes:
      - ./docker/mosquitto.conf:/mosquitto/config/mosquitto.conf:ro

  pds-edge:
    build:
      context: .
      dockerfile: docker/Dockerfile.mac-dev
    env_file:
      - ./.env
    environment:
      - GODOWN_ID=${GODOWN_ID}
      - EDGE_TIMEZONE=${EDGE_TIMEZONE}
      - EDGE_BACKEND_URL=${EDGE_BACKEND_URL}
      - EDGE_BACKEND_TOKEN=${EDGE_BACKEND_TOKEN}
      - EDGE_RULES_SOURCE=${EDGE_RULES_SOURCE}
      - EDGE_CAMERAS_SOURCE=${EDGE_CAMERAS_SOURCE}
      - MQTT_BROKER_HOST=mosquitto
      - YOLO_CONFIG_DIR=/opt/app/.config/Ultralytics
      - INSIGHTFACE_HOME=/opt/app/.insightface
    volumes:
      - ./:/opt/app
      - ./data:/opt/app/data
      - ./models:/opt/app/models
      - ./cache/ultralytics:/opt/app/.config/Ultralytics
      - ./cache/insightface:/opt/app/.insightface
    depends_on:
      - mosquitto
